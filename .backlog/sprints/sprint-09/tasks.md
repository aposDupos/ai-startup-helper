# Sprint 09 — Smart Chat (~1 нед)

**Цель:** AI понимает контекст автоматически, entry points полноценно работают с автоматическим созданием проектов.
**Зависимости:** S06-002, S06-004 (entry points + badge).

---

## S09-001: Auto-routing AI
**Статус:** [x]
**Зависимости:** S06-004
**Описание:** AI автоматически определяет контекст разговора без ручного переключения.
**Действия:**
- Обновить system prompt в `src/lib/ai/prompts/index.ts`: добавить инструкцию "определи тему на основе первого сообщения"
- При наличии `project.stage` — использовать соответствующий промпт автоматически
- При отсутствии проекта — использовать "general" промпт, который умеет создать проект
- Логировать определённый контекст в `ai_logs`
**Файлы:**
- `src/lib/ai/prompts/index.ts` — auto-routing logic
- `src/app/api/chat/route.ts` — pass context info
**Критерии приёмки:**
- [x] Сообщение "хочу открыть кофейню" → AI переключается на context idea
- [x] Сообщение "как заполнить BMC" → AI в контексте business_model
- [x] Текущая стадия проекта автоматически используется как default context
- [x] Нет ручного переключения контекста

---

## S09-002: Entry Point — "У меня есть идея"
**Статус:** [x]
**Зависимости:** S06-002, S09-001
**Описание:** Полный flow: описание идеи → автоматическое создание проекта → redirect на Dashboard.
**Действия:**
- AI после получения описания идеи вызывает `update_project_artifacts` с field=`idea_formulation`
- Если проекта нет — AI сначала вызывает tool `create_project` (нужно создать)
- После создания → AI поздравляет и предлагает перейти к следующему шагу
- Redirect на Dashboard через client-side navigation
**Файлы:**
- `src/lib/ai/tools/create-project.ts` [NEW] — tool для создания проекта из чата
- `src/lib/ai/prompts/index.ts` — промпт для idea_evaluation context
**Критерии приёмки:**
- [x] Описание идеи → проект автоматически создаётся
- [x] Артефакт `idea_formulation` заполнен
- [x] Checklist item `formulate_idea` отмечен
- [x] AI предлагает перейти на Dashboard

---

## S09-003: Entry Point — "У меня уже проект"
**Статус:** [x]
**Зависимости:** S09-002
**Описание:** AI определяет стадию существующего проекта через серию вопросов.
**Действия:**
- Промпт для `project_assessment` context: AI задаёт 3-5 вопросов о проекте
- На основе ответов определяет стадию (idea/validation/bmc/mvp/pitch)
- Создаёт проект на определённой стадии
- Pre-fills прогресс: стадии до текущей помечаются как completed
- Заполняет известные артефакты
**Файлы:**
- `src/lib/ai/prompts/index.ts` — промпт для project_assessment
- `src/lib/ai/tools/create-project.ts` — поддержка стадии при создании
**Критерии приёмки:**
- [x] AI задаёт вопросы о проекте
- [x] Определяет стадию автоматически
- [x] Проект создаётся на правильной стадии
- [x] Предыдущие стадии помечены как completed

---

## S09-004: Entry Point — "Хочу учиться"
**Статус:** [x]
**Зависимости:** S08-001
**Описание:** Redirect на страницу обучения + AI-рекомендация.
**Действия:**
- При `context=learning` — redirect на `/learning`
- Если проект есть → AI рекомендует урок на основе стадии
- Если проекта нет → AI рекомендует вводный урок
**Файлы:**
- `src/app/(main)/chat/page.tsx` — redirect logic for learning context
- `src/app/(main)/learning/page.tsx` — handle redirect with recommendation
**Критерии приёмки:**
- [x] Клик "Хочу учиться" → открывается `/learning`
- [x] AI рекомендует первый актуальный урок
- [x] После урока — предложение вернуться к проекту
